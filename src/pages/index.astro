---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero';
import PostCard from '../components/PostCard.astro';
import { getCollection } from 'astro:content';

// Get all posts, sorted by date (newest first)
const allPosts = await getCollection('posts');
const sortedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

// Get featured posts (latest 3)
const featuredPosts = sortedPosts.slice(0, 3);
---

<Layout title="Cluttered Cabinet">
  <Hero client:load />

  {featuredPosts.length > 0 && (
    <section class="max-w-6xl mx-auto px-6 md:px-12 py-12">
      <h2 class="font-mono text-2xl mb-6 text-text-primary font-bold tracking-tight">recent_posts</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {featuredPosts.map(post => (
          <PostCard
            title={post.data.title}
            date={post.data.date}
            summary={post.data.summary}
            slug={post.slug}
            tags={post.data.tags}
          />
        ))}
      </div>

      <div class="mt-8">
        <a href="/posts" class="inline-block text-accent hover:text-accent-bright font-mono text-sm">
          â†’ view_all
        </a>
      </div>
    </section>
  )}
</Layout>
