---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero';
import ResearchOverview from '../components/ResearchOverview.astro';
import PostCard from '../components/PostCard.astro';
import { getCollection } from 'astro:content';

// Get all posts, sorted by date (newest first)
const allPosts = await getCollection('posts');
const sortedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
---

<Layout title="Cluttered Cabinet">
  <Hero client:load />
  <ResearchOverview />
  <div class="px-6 md:px-12 my-8" aria-hidden="true">
    <div class="mx-auto max-w-6xl border-t border-border/60 opacity-70"></div>
  </div>

  {sortedPosts.length > 0 && (
    <section class="max-w-4xl mx-auto px-6 md:px-12 py-12">
      <h2 class="font-mono text-lg mb-6 text-text-primary tracking-tight">notebook entries</h2>

      <div class="space-y-0">
        {sortedPosts.map((post, index) => (
          <PostCard
            title={post.data.title}
            date={post.data.date}
            summary={post.data.summary}
            slug={post.slug}
            tags={post.data.tags}
            index={sortedPosts.length - index}
          />
        ))}
      </div>
    </section>
  )}
</Layout>
